!function(window){function GetRequest(model){this.model=model,this.url="",this.query=[],this.method="GET",this.xhr=new XMLHttpRequest}function PostRequest(model){this.model=model,this.url="",this.method="POST",this.xhr=new XMLHttpRequest}var Sapling={get:function(model){return new GetRequest(model)},post:function(model){return new PostRequest(model)}};GetRequest.prototype={where:function(field,value){return this.url=field+"/"+value,this},range:function(field,from,to){return this.url=field+"/"+from+"/"+to,this},limit:function(skip,limit){var q="limit=";return q+=1==arguments.length?skip:skip+","+limit,this.query.push(q),this},sort:function(field,direction){return direction=1==direction?"asc":"desc",this.query.push("sort="+field+","+direction),this},single:function(){return this.query.push("single=true"),this},end:function(callback){var url="/data/"+this.model+"/"+this.url;return this.query.length&&(url+="?"+this.query.join("&")),this.xhr.open(this.method,url),this.xhr.setRequestHeader("Accept","application/json"),this.xhr.onreadystatechange=function(){if(4==this.xhr.readyState&&this.xhr.status){var data=null;try{data=JSON.parse(this.xhr.responseText)}catch(e){data=null}callback&&callback(200===this.xhr.status?null:this.xhr,data)}}.bind(this),this.xhr.onerror=function(){callback&&callback({status:0})},this.xhr.send(),this}},PostRequest.prototype={where:function(field,value){return this.url=field+"/"+value,this},data:function(obj){return this.data=obj,this},end:function(callback){var url="/data/"+this.model+"/"+this.url;this.xhr.open(this.method,url),this.xhr.setRequestHeader("Accept","application/json"),this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.onreadystatechange=function(){if(4==this.xhr.readyState&&this.xhr.status){var data=null;try{data=JSON.parse(this.xhr.responseText)}catch(e){data=null}callback&&callback(200===this.xhr.status?null:this.xhr,data)}}.bind(this),this.xhr.onerror=function(){callback&&callback({status:0})},this.xhr.send(JSON.stringify(this.data))}},Sapling.isLogged=function(){var xhr=new XMLHttpRequest;xhr.open("GET","/api/logged",!1),xhr.send();var data=!1;try{data=JSON.parse(xhr.responseText)}catch(e){}return data},Sapling.signUp=function(user){var xhr=new XMLHttpRequest;xhr.open("POST","/api/register",!1),xhr.send(JSON.stringify(user));var data=!1;try{data=JSON.parse(xhr.responseText)}catch(e){}return data},Sapling.signIn=function(user){var xhr=new XMLHttpRequest;xhr.open("POST","/api/login",!1),xhr.send(JSON.stringify(user));var data=!1;try{data=JSON.parse(xhr.responseText)}catch(e){}return data},Sapling.signOut=function(){var xhr=new XMLHttpRequest;return xhr.open("GET","/api/logout",!1),xhr.send(),!0},Sapling.changePassword=function(old,pass){var xhr=new XMLHttpRequest;xhr.open("POST","/api/update",!1),xhr.send(JSON.stringify({pass:old,newpass:pass}));var data=!1;try{data=JSON.parse(xhr.responseText)}catch(e){}return data},Sapling.register=Sapling.signUp,Sapling.login=Sapling.signIn,Sapling.logout=Sapling.signOut,window.Sapling=Sapling}(window);